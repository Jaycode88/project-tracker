{% load static %}
<!DOCTYPE html>
<html>

<head>
    <title>{{ project.name }}</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="{% static 'js/fetch_commits.js' %}"></script>
    <meta name="csrf-token" content="{{ csrf_token }}">
</head>

<body>
    <h1>{{ project.name }}</h1>
    <p><strong>Start Date:</strong> {{ project.start_date }}</p>
    <p><strong>Total Estimated Working Hours:</strong> {{ total_estimated_hours|floatformat:2 }}</p>

    <button id="fetch-commits" data-project-id="{{ project.id }}"
        data-fetch-url="{% url 'fetch_commits' project.id %}">Fetch Data</button>
    <p id="fetch-status"></p>

    <form action="{% url 'delete_project' project.id %}" method="post" style="display:inline;">
        {% csrf_token %}
        <button type="submit" style="background-color:red;color:white;">Delete Project</button>
    </form>

    <a href="{% url 'project_list' %}">Back to Projects</a>

    {% if grouped_commits %}
    <h2>Commit Data</h2>
    {% for date, commits in grouped_commits %}
    <h3>{{ date }}</h3>

    {% with times=daily_work_times|default_if_none:'' %}
    {% if times %}
    {% for commit_date, time_values in daily_work_times.items %}
    {% if commit_date == date %}
    <p><strong>Time of first commit:</strong> {{ time_values.first_commit|date:"P" }}</p>
    <p><strong>Time of last commit:</strong> {{ time_values.last_commit|date:"P" }}</p>
    <p><strong>Estimated daily hours:</strong> {{ time_values.daily_hours|floatformat:2 }}</p>
    {% endif %}
    {% endfor %}
    {% else %}
    <p>No commit times available</p>
    {% endif %}
    {% endwith %}

    <ul>
        {% for commit in commits %}
        <li>
            <p>{{ commit.commit_time|date:"P" }} - {{ commit.commit_message }}</p>
            {% if commit.time_since_last_commit %}
            <p>Time since last commit: {{ commit.time_since_last_commit }}</p>
            {% endif %}
        </li>
        {% endfor %}
    </ul>
    {% endfor %}
    <button id="fetch-commits" data-project-id="{{ project.id }}"
        data-fetch-url="{% url 'fetch_commits' project.id %}">Fetch Data</button>
    <p id="fetch-status"></p>
    <form action="{% url 'delete_project' project.id %}" method="post" style="display:inline;">
        {% csrf_token %}
        <button type="submit" style="background-color:red;color:white;">Delete Project</button>
    </form>
    <a href="{% url 'project_list' %}">Back to Projects</a>
    {% endif %}

</body>

</html>